
<!doctype html>
<html>
  <head>
    <title>sMind Test</title>

	<link type="text/css" rel="stylesheet" href="libs/spectrum/spectrum.css" />
    <link type="text/css" rel="stylesheet" href="libs/jquery-ui/jquery-ui.css" />
    <link type="text/css" rel="stylesheet" href="css/network.css" />

	<script type="text/javascript" src="libs/vis/dist/vis.js"></script>
	<script type="text/javascript" src="libs/jquery/dist/jquery.js"></script>
	<script type="text/javascript" src="js/network.js"></script>
	<script type="text/javascript" src="libs/spectrum/spectrum.js"></script>
	<script type="text/javascript" src="libs/jquery-ui/jquery-ui.js"></script>

    <script>
      $(function() {
        $( "#searchRangeFrom" ).datepicker({
          changeMonth: true,
          numberOfMonths: 1,
	      dateFormat: "yy-mm-dd",
          onClose: function( selectedDate ) {
            $( "#searchRangeTo" ).datepicker( "option", "minDate", selectedDate );
          }
        });
        $( "#searchRangeTo" ).datepicker({
          changeMonth: true,
          numberOfMonths: 1,
	      dateFormat: "yy-mm-dd",
          onClose: function( selectedDate ) {
            $( "#searchRnageFrom" ).datepicker( "option", "maxDate", selectedDate );
          }
        });

		function testAddNode() {
		  createAddNodeToolbar();    
		  for(i=0; i<10; i++) { 
			var data = {
			  id:i,
		      x:-(250-(i*50)),
		      y:-(200-((i%2)*50)),
		      allowedToMoveX:true,
		      allowedToMoveY:true
			};
			try {
			  onAdd(data,function(finalizedData) {
				network.nodesData.add(finalizedData);
				network.moving = true;
				network.start();
			  });
			  console.log("Node created successfully")
			}
			catch (err) {
			  console.log("cannot create node, node with id: " + data.id + " already exists");
			}
		  }
		  network._createManipulatorBar();
		}
		$('#addNodeTest').on('click', testAddNode);



		$('#addEdgeTest').on('click', function() {
		  console.log("add edge test");     
		  createAddEdgeToolbar();  
		  
		  var nodeIds = nodes.getIds();
		  var length = nodeIds.length;
		  var data = {};
		  data.style ="line";
		  var id = 10;

	      for (i=0; i < 10; i++) {
			data.from=i;
			data.to=i+2;
			data.id=i+2;
			console.log("FROM:"+data.from+" TO:"+data.to)
			
			if ((nodeIds.indexOf(data.from) > -1) && (nodeIds.indexOf(data.to) > -1)) {
			  console.log("Even/Odd Edge created successfully");
			  onConnect(data,function(finalizedData) {	
		    	network.edgesData.update(finalizedData);
				network.moving = true;
				network.start();
			  });
			}

			
			data.from=i;
			data.to= i+1;
			console.log("FROM:"+nodeIds.indexOf(data.from)+" TO:"+nodeIds.indexOf(data.to))
			
				if ((nodeIds.indexOf(data.from) > -1) && (nodeIds.indexOf(data.to) > -1)) {
			  console.log("Diagonal Edge created successfully");
			  data.id = id++;;
			  onConnect(data,function(finalizedData) {	
				network.edgesData.update(finalizedData);
				network.moving = true;
				network.start();
			  });
			}
		  }
          network._createManipulatorBar();
		});

		$('#delNodeTest').on('click', function() {
			console.log("delete node test")
		    var select = [];
		    var nodeArr = nodes.getIds();
		    for (i = 0; i < nodeArr.length; i++) {
		      if (i%2==0) {
			    select.push(nodeArr[i]);
			  }
			}
			network.selectNodes(select,true);
			network._deleteSelected();
		});

		$('#delEdgeTest').on('click', function() {
		  console.log("delete node test")
		  var select = [];
		  var edgeArr = edges.getIds();
		  for (i = 0; i < edgeArr.length; i++) {
		    if (i%2==0) {
			  select.push(edgeArr[i]);
			}
		  }
		  console.log(select);
		  network.selectEdges(select);
		  network._deleteSelected();
	    });

		$('#saveTest').on('click', function() {
		  var data = {};
	      saveMap("test", data);
		});

		$('#loadTest').on('click', function() {
		  $.ajax({
		    type: "GET",
		    url: "/data",
		    contentType: "application/json",
		    dataType: "json",
		    success: function (data) {
		      nodes.clear();
		      edges.clear();
		      loadMap("test", data);
		    }
          });
		});
      });
    </script>
  </head>

  <body onload="draw();">

	<h1><img src="css/img/sMind.png" alt="sMind" style="width:188px; height=56px;"></h1>

	<button id="addNodeTest">addNodeTest</button>
	<button id="delNodeTest">delNodeTest</button>
	<button id="addEdgeTest">addEdgeTest</button>
	<button id="delEdgeTest">delEdgeTest</button>
	<button id="saveTest">saveTest</button>
	<button id="loadTest">loadTest</button>
	<br>

	<div style="width:1500px;">
		<div id="network" style="width:1100px; float:right;"></div>
		<div id="searchDiv" class="searchDiv">
		  <form id="searchForm" action="" method="">
		    <input type="hidden" name="wt" value="json">
		    
			<input type="text" id="searchID" name="q" value="">
		    <button id="searchButton">Search</button>
			<br>
			
			<label for="from" style='margin-left:5px;'>From</label>
			<input type="text" id="searchRangeFrom" name="from" class="searchDateRange">
			<label for="to">to</label>
			<input type="text" id="searchRangeTo" name="to" class="searchDateRange">  
		    <br>
			
			<input type="checkbox" id="title" value="title" style='margin-left: 5px'>Title</td>
			<input type="checkbox" id="author" value="author">Author</td>
			<input type="checkbox" id="text" value="text">Text</td>
	      </form>

		  <hr style='margin: 5px; border-color:white;'>
		  <ul id="searchResult"></ul>
		</div>	 
	</div>
	
	<div id="filePopup" title="sMind Map">
	  <table id='mapTable'></table>
	</div>

	<iframe src="" id="downloadFrame" style="display:none;"></iframe>
      
  </body>
</html>
